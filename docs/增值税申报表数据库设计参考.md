
## 增值税申报表主表数据库设计方案

### 1. 企业信息维度表（dim_company）
```sql
CREATE TABLE dim_company (
    company_id INTEGER PRIMARY KEY AUTOINCREMENT,
    taxpayer_id VARCHAR(18) UNIQUE NOT NULL,  -- 纳税人识别号
    company_name VARCHAR(200) NOT NULL,        -- 企业名称
    legal_representative VARCHAR(50),          -- 法定代表人
    industry VARCHAR(100),                     -- 所属行业
    registration_type VARCHAR(10),             -- 登记注册类型
    registered_address TEXT,                   -- 注册地址
    business_address TEXT,                     -- 生产经营地址
    bank_account VARCHAR(100),                 -- 开户银行及账号
    phone VARCHAR(20),                         -- 电话号码
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_taxpayer_id ON dim_company(taxpayer_id);
```

### 2. 申报期间维度表（dim_period）
```sql
CREATE TABLE dim_period (
    period_id INTEGER PRIMARY KEY AUTOINCREMENT,
    tax_period VARCHAR(7) NOT NULL,            -- 税款所属期间 格式：2024-07
    start_date DATE NOT NULL,                  -- 起始日期
    end_date DATE NOT NULL,                    -- 结束日期
    year INTEGER NOT NULL,                     -- 年份
    month INTEGER NOT NULL,                    -- 月份
    quarter INTEGER NOT NULL,                  -- 季度
    UNIQUE(tax_period)
);

CREATE INDEX idx_tax_period ON dim_period(tax_period);
CREATE INDEX idx_year_month ON dim_period(year, month);
```

### 3. 申报表主表（fact_vat_return）

```sql
CREATE TABLE fact_vat_return (
    return_id INTEGER PRIMARY KEY AUTOINCREMENT,
    company_id INTEGER NOT NULL,
    period_id INTEGER NOT NULL,
    filing_date DATE,                          -- 填表日期
    
    -- ========================================
    -- 一般项目 - 销售额部分
    -- ========================================
    -- 栏次1：按适用税率计税销售额
    gen_sales_taxable_current DECIMAL(18,2),           -- 本月数
    gen_sales_taxable_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次2：应税货物销售额
    gen_sales_goods_current DECIMAL(18,2),             -- 本月数
    gen_sales_goods_ytd DECIMAL(18,2),                 -- 本年累计
    
    -- 栏次3：应税劳务销售额
    gen_sales_service_current DECIMAL(18,2),           -- 本月数
    gen_sales_service_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次4：纳税检查调整的销售额
    gen_sales_adjustment_current DECIMAL(18,2),        -- 本月数
    gen_sales_adjustment_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次5：按简易办法计税销售额
    gen_sales_simple_current DECIMAL(18,2),            -- 本月数
    gen_sales_simple_ytd DECIMAL(18,2),                -- 本年累计
    
    -- 栏次6：按简易办法计税销售额中的纳税检查调整
    gen_sales_simple_adjustment_current DECIMAL(18,2), -- 本月数
    gen_sales_simple_adjustment_ytd DECIMAL(18,2),     -- 本年累计
    
    -- 栏次7：免、抵、退办法出口销售额
    gen_sales_export_current DECIMAL(18,2),            -- 本月数
    gen_sales_export_ytd DECIMAL(18,2),                -- 本年累计
    
    -- 栏次8：免税销售额
    gen_sales_exempt_current DECIMAL(18,2),            -- 本月数
    gen_sales_exempt_ytd DECIMAL(18,2),                -- 本年累计
    
    -- 栏次9：免税货物销售额
    gen_sales_exempt_goods_current DECIMAL(18,2),      -- 本月数
    gen_sales_exempt_goods_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次10：免税劳务销售额
    gen_sales_exempt_service_current DECIMAL(18,2),    -- 本月数
    gen_sales_exempt_service_ytd DECIMAL(18,2),        -- 本年累计
    
    -- ========================================
    -- 一般项目 - 税款计算部分
    -- ========================================
    -- 栏次11：销项税额
    gen_output_tax_current DECIMAL(18,2),              -- 本月数
    gen_output_tax_ytd DECIMAL(18,2),                  -- 本年累计
    
    -- 栏次12：进项税额
    gen_input_tax_current DECIMAL(18,2),               -- 本月数
    gen_input_tax_ytd DECIMAL(18,2),                   -- 本年累计
    
    -- 栏次13：上期留抵税额
    gen_previous_credit_current DECIMAL(18,2),         -- 本月数
    gen_previous_credit_ytd DECIMAL(18,2),             -- 本年累计
    
    -- 栏次14：进项税额转出
    gen_input_tax_transfer_current DECIMAL(18,2),      -- 本月数
    gen_input_tax_transfer_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次15：免、抵、退应退税额（只有本月数）
    gen_export_refund_current DECIMAL(18,2),           -- 本月数
    
    -- 栏次16：按适用税率计算的纳税检查应补缴税额（只有本月数）
    gen_tax_inspection_current DECIMAL(18,2),          -- 本月数
    
    -- 栏次17：应抵扣税额合计（只有本月数）
    gen_deductible_total_current DECIMAL(18,2),        -- 本月数
    
    -- 栏次18：实际抵扣税额
    gen_actual_deduction_current DECIMAL(18,2),        -- 本月数
    gen_actual_deduction_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次19：应纳税额
    gen_tax_payable_current DECIMAL(18,2),             -- 本月数
    gen_tax_payable_ytd DECIMAL(18,2),                 -- 本年累计
    
    -- 栏次20：期末留抵税额（只有本月数）
    gen_ending_credit_current DECIMAL(18,2),           -- 本月数
    
    -- 栏次21：简易计税办法计算的应纳税额
    gen_simple_tax_current DECIMAL(18,2),              -- 本月数
    gen_simple_tax_ytd DECIMAL(18,2),                  -- 本年累计
    
    -- 栏次22：按简易计税办法计算的纳税检查应补缴税额（只有本月数）
    gen_simple_inspection_current DECIMAL(18,2),       -- 本月数
    
    -- 栏次23：应纳税额减征额
    gen_tax_reduction_current DECIMAL(18,2),           -- 本月数
    gen_tax_reduction_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次24：应纳税额合计
    gen_tax_total_current DECIMAL(18,2),               -- 本月数
    gen_tax_total_ytd DECIMAL(18,2),                   -- 本年累计
    
    -- ========================================
    -- 一般项目 - 税款缴纳部分
    -- ========================================
    -- 栏次25：期初未缴税额（多缴为负数）
    gen_opening_unpaid_tax_current DECIMAL(18,2),      -- 本月数
    gen_opening_unpaid_tax_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次26：实收出口开具专用缴款书退税额（只有本月数）
    gen_export_refund_received_current DECIMAL(18,2),  -- 本月数
    
    -- 栏次27：本期已缴税额
    gen_paid_tax_total_current DECIMAL(18,2),          -- 本月数
    gen_paid_tax_total_ytd DECIMAL(18,2),              -- 本年累计
    
    -- 栏次28：分次预缴税额（只有本月数）
    gen_prepaid_tax_current DECIMAL(18,2),             -- 本月数
    
    -- 栏次29：出口开具专用缴款书预缴税额（只有本月数）
    gen_export_prepaid_current DECIMAL(18,2),          -- 本月数
    
    -- 栏次30：本期缴纳上期应纳税额
    gen_paid_previous_tax_current DECIMAL(18,2),       -- 本月数
    gen_paid_previous_tax_ytd DECIMAL(18,2),           -- 本年累计
    
    -- 栏次31：本期缴纳欠缴税额
    gen_paid_overdue_tax_current DECIMAL(18,2),        -- 本月数
    gen_paid_overdue_tax_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次32：期末未缴税额（多缴为负数）
    gen_ending_unpaid_tax_current DECIMAL(18,2),       -- 本月数
    gen_ending_unpaid_tax_ytd DECIMAL(18,2),           -- 本年累计
    
    -- 栏次33：欠缴税额（只有本月数）
    gen_overdue_tax_current DECIMAL(18,2),             -- 本月数
    
    -- 栏次34：本期应补(退)税额（只有本月数）
    gen_tax_payable_refund_current DECIMAL(18,2),      -- 本月数
    
    -- 栏次36：期初未缴查补税额（只有本月数）
    gen_opening_inspection_unpaid_current DECIMAL(18,2), -- 本月数
    gen_opening_inspection_unpaid_ytd DECIMAL(18,2),     -- 本年累计
    
    -- 栏次37：本期入库查补税额（只有本月数）
    gen_inspection_paid_current DECIMAL(18,2),         -- 本月数
    gen_inspection_paid_ytd DECIMAL(18,2),             -- 本年累计
    
    -- 栏次38：期末未缴查补税额（只有本月数）
    gen_ending_inspection_unpaid_current DECIMAL(18,2), -- 本月数
    gen_ending_inspection_unpaid_ytd DECIMAL(18,2),     -- 本年累计
    
    -- ========================================
    -- 即征即退项目 - 销售额部分
    -- ========================================
    -- 栏次1：按适用税率计税销售额
    ref_sales_taxable_current DECIMAL(18,2),           -- 本月数
    ref_sales_taxable_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次2：应税货物销售额
    ref_sales_goods_current DECIMAL(18,2),             -- 本月数
    ref_sales_goods_ytd DECIMAL(18,2),                 -- 本年累计
    
    -- 栏次3：应税劳务销售额
    ref_sales_service_current DECIMAL(18,2),           -- 本月数
    ref_sales_service_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次4：纳税检查调整的销售额
    ref_sales_adjustment_current DECIMAL(18,2),        -- 本月数
    ref_sales_adjustment_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次5：按简易办法计税销售额
    ref_sales_simple_current DECIMAL(18,2),            -- 本月数
    ref_sales_simple_ytd DECIMAL(18,2),                -- 本年累计
    
    -- 栏次6：按简易办法计税销售额中的纳税检查调整
    ref_sales_simple_adjustment_current DECIMAL(18,2), -- 本月数
    ref_sales_simple_adjustment_ytd DECIMAL(18,2),     -- 本年累计
    
    -- 栏次8：免税销售额（即征即退项目无此栏）
    -- 栏次9：免税货物销售额（即征即退项目无此栏）
    -- 栏次10：免税劳务销售额（即征即退项目无此栏）
    
    -- ========================================
    -- 即征即退项目 - 税款计算部分
    -- ========================================
    -- 栏次11：销项税额
    ref_output_tax_current DECIMAL(18,2),              -- 本月数
    ref_output_tax_ytd DECIMAL(18,2),                  -- 本年累计
    
    -- 栏次12：进项税额
    ref_input_tax_current DECIMAL(18,2),               -- 本月数
    ref_input_tax_ytd DECIMAL(18,2),                   -- 本年累计
    
    -- 栏次13：上期留抵税额
    ref_previous_credit_current DECIMAL(18,2),         -- 本月数
    -- 即征即退项目栏次13本年累计为"——"，不设计字段
    
    -- 栏次14：进项税额转出
    ref_input_tax_transfer_current DECIMAL(18,2),      -- 本月数
    ref_input_tax_transfer_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次17：应抵扣税额合计（只有本月数）
    ref_deductible_total_current DECIMAL(18,2),        -- 本月数
    
    -- 栏次18：实际抵扣税额
    ref_actual_deduction_current DECIMAL(18,2),        -- 本月数
    ref_actual_deduction_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次19：应纳税额
    ref_tax_payable_current DECIMAL(18,2),             -- 本月数
    ref_tax_payable_ytd DECIMAL(18,2),                 -- 本年累计
    
    -- 栏次20：期末留抵税额（只有本月数）
    ref_ending_credit_current DECIMAL(18,2),           -- 本月数
    
    -- 栏次21：简易计税办法计算的应纳税额
    ref_simple_tax_current DECIMAL(18,2),              -- 本月数
    ref_simple_tax_ytd DECIMAL(18,2),                  -- 本年累计
    
    -- 栏次23：应纳税额减征额
    ref_tax_reduction_current DECIMAL(18,2),           -- 本月数
    ref_tax_reduction_ytd DECIMAL(18,2),               -- 本年累计
    
    -- 栏次24：应纳税额合计
    ref_tax_total_current DECIMAL(18,2),               -- 本月数
    ref_tax_total_ytd DECIMAL(18,2),                   -- 本年累计
    
    -- ========================================
    -- 即征即退项目 - 税款缴纳部分
    -- ========================================
    -- 栏次25：期初未缴税额（多缴为负数）
    ref_opening_unpaid_tax_current DECIMAL(18,2),      -- 本月数
    ref_opening_unpaid_tax_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次27：本期已缴税额
    ref_paid_tax_total_current DECIMAL(18,2),          -- 本月数
    ref_paid_tax_total_ytd DECIMAL(18,2),              -- 本年累计
    
    -- 栏次28：分次预缴税额（只有本月数）
    ref_prepaid_tax_current DECIMAL(18,2),             -- 本月数
    
    -- 栏次30：本期缴纳上期应纳税额
    ref_paid_previous_tax_current DECIMAL(18,2),       -- 本月数
    ref_paid_previous_tax_ytd DECIMAL(18,2),           -- 本年累计
    
    -- 栏次31：本期缴纳欠缴税额
    ref_paid_overdue_tax_current DECIMAL(18,2),        -- 本月数
    ref_paid_overdue_tax_ytd DECIMAL(18,2),            -- 本年累计
    
    -- 栏次32：期末未缴税额（多缴为负数）
    ref_ending_unpaid_tax_current DECIMAL(18,2),       -- 本月数
    ref_ending_unpaid_tax_ytd DECIMAL(18,2),           -- 本年累计
    
    -- 栏次33：欠缴税额（只有本月数）
    ref_overdue_tax_current DECIMAL(18,2),             -- 本月数
    
    -- 栏次34：本期应补(退)税额（只有本月数）
    ref_tax_payable_refund_current DECIMAL(18,2),      -- 本月数
    
    -- 栏次35：即征即退实际退税额
    ref_actual_refund_current DECIMAL(18,2),           -- 本月数
    ref_actual_refund_ytd DECIMAL(18,2),               -- 本年累计
    
    -- ========================================
    -- 附加税费（只有一般项目，即征即退项目均为"——"）
    -- ========================================
    -- 栏次39：城市维护建设税本期应补（退）税额（只有本月数）
    urban_construction_tax_current DECIMAL(18,2),      -- 本月数
    urban_construction_tax_ytd DECIMAL(18,2),          -- 本年累计
    
    -- 栏次40：教育费附加本期应补（退）费额（只有本月数）
    education_surcharge_current DECIMAL(18,2),         -- 本月数
    education_surcharge_ytd DECIMAL(18,2),             -- 本年累计
    
    -- 栏次41：地方教育附加本期应补（退）费额（只有本月数）
    local_education_surcharge_current DECIMAL(18,2),   -- 本月数
    local_education_surcharge_ytd DECIMAL(18,2),       -- 本年累计
    
    -- ========================================
    -- 申报信息
    -- ========================================
    preparer VARCHAR(50),                              -- 经办人
    preparer_id_card VARCHAR(18),                      -- 经办人身份证号
    taxpayer_signature VARCHAR(200),                   -- 纳税人（签章）
    signature_date DATE,                               -- 签章日期
    receiver VARCHAR(50),                              -- 受理人
    agent_org VARCHAR(200),                            -- 代理机构签章
    agent_org_code VARCHAR(18),                        -- 代理机构统一社会信用代码
    tax_authority VARCHAR(200),                        -- 受理税务机关（章）
    acceptance_date DATE,                              -- 受理日期
    
    -- ========================================
    -- 元数据
    -- ========================================
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (company_id) REFERENCES dim_company(company_id),
    FOREIGN KEY (period_id) REFERENCES dim_period(period_id),
    UNIQUE(company_id, period_id)
);

CREATE INDEX idx_company_period ON fact_vat_return(company_id, period_id);
CREATE INDEX idx_filing_date ON fact_vat_return(filing_date);
CREATE INDEX idx_gen_tax_total ON fact_vat_return(gen_tax_total_current);
```

### 4. 字段设计说明文档

```sql
-- 创建字段说明表（便于维护和理解）
CREATE TABLE meta_field_mapping (
    field_id INTEGER PRIMARY KEY AUTOINCREMENT,
    table_name VARCHAR(50),
    field_name VARCHAR(100),
    line_number VARCHAR(10),      -- 栏次
    field_description VARCHAR(200), -- 字段描述
    project_type VARCHAR(20),      -- 项目类型：一般项目/即征即退项目
    period_type VARCHAR(20),       -- 期间类型：本月数/本年累计
    is_applicable BOOLEAN,         -- 是否适用（FALSE表示"——"的字段）
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 插入字段映射数据示例
INSERT INTO meta_field_mapping (table_name, field_name, line_number, field_description, project_type, period_type, is_applicable) VALUES
('fact_vat_return', 'gen_sales_taxable_current', '1', '按适用税率计税销售额', '一般项目', '本月数', 1),
('fact_vat_return', 'gen_sales_taxable_ytd', '1', '按适用税率计税销售额', '一般项目', '本年累计', 1),
('fact_vat_return', 'gen_sales_goods_current', '2', '应税货物销售额', '一般项目', '本月数', 1),
('fact_vat_return', 'gen_sales_goods_ytd', '2', '应税货物销售额', '一般项目', '本年累计', 1),
-- ... 继续插入其他字段映射
('fact_vat_return', 'ref_sales_taxable_current', '1', '按适用税率计税销售额', '即征即退项目', '本月数', 1),
('fact_vat_return', 'ref_sales_taxable_ytd', '1', '按适用税率计税销售额', '即征即退项目', '本年累计', 1);
-- ... 继续插入
```

### 5. 数据导入Python脚本示例

```python
import sqlite3
import pandas as pd
from datetime import datetime
import re

def parse_tax_period(period_str):
    """解析税款所属时间"""
    # 从 "自2024年7月1日至2024年7月31日" 提取年月
    match = re.search(r'(\d{4})年(\d{1,2})月', period_str)
    if match:
        year = int(match.group(1))
        month = int(match.group(2))
        return year, month, (month - 1) // 3 + 1
    return None, None, None

def import_vat_return(excel_file, db_path='vat_database.db'):
    """导入增值税申报表数据"""
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # 读取Excel（需要根据实际格式调整）
    df = pd.read_excel(excel_file, header=None)
    
    # 提取企业基本信息
    taxpayer_id = str(df.iloc[3, 1])  # 纳税人识别号所在单元格
    company_name = str(df.iloc[4, 1])  # 企业名称
    legal_rep = str(df.iloc[4, 3])     # 法定代表人
    industry = str(df.iloc[3, 6])      # 所属行业
    
    # 插入或更新企业信息
    cursor.execute('''
        INSERT OR REPLACE INTO dim_company 
        (taxpayer_id, company_name, legal_representative, industry, 
         registration_type, registered_address, business_address, 
         bank_account, phone)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
    ''', (
        taxpayer_id, company_name, legal_rep, industry,
        str(df.iloc[5, 2]),  # 登记注册类型
        str(df.iloc[4, 5]),  # 注册地址
        str(df.iloc[4, 7]),  # 生产经营地址
        str(df.iloc[5, 1]),  # 银行账号
        str(df.iloc[5, 5])   # 电话号码
    ))
    
    company_id = cursor.execute(
        'SELECT company_id FROM dim_company WHERE taxpayer_id = ?', 
        (taxpayer_id,)
    ).fetchone()[0]
    
    # 提取税款所属期间
    period_str = str(df.iloc[2, 1])  # 税款所属时间
    year, month, quarter = parse_tax_period(period_str)
    start_date = f"{year}-{month:02d}-01"
    
    # 计算月末日期
    import calendar
    last_day = calendar.monthrange(year, month)[1]
    end_date = f"{year}-{month:02d}-{last_day:02d}"
    tax_period = f"{year}-{month:02d}"
    
    # 插入期间信息
    cursor.execute('''
        INSERT OR IGNORE INTO dim_period 
        (tax_period, start_date, end_date, year, month, quarter)
        VALUES (?, ?, ?, ?, ?, ?)
    ''', (tax_period, start_date, end_date, year, month, quarter))
    
    period_id = cursor.execute(
        'SELECT period_id FROM dim_period WHERE tax_period = ?',
        (tax_period,)
    ).fetchone()[0]
    
    # 提取填表日期
    filing_date_str = str(df.iloc[2, 6])  # 填表日期
    
    # 提取申报数据（根据实际Excel行列位置调整）
    # 一般项目数据提取
    data_dict = {
        'company_id': company_id,
        'period_id': period_id,
        'filing_date': filing_date_str,
        
        # 销售额部分（从Excel中提取具体单元格值）
        'gen_sales_taxable_current': float(df.iloc[9, 4]) if pd.notna(df.iloc[9, 4]) else None,
        'gen_sales_taxable_ytd': float(df.iloc[9, 5]) if pd.notna(df.iloc[9, 5]) else None,
        'gen_sales_goods_current': float(df.iloc[10, 4]) if pd.notna(df.iloc[10, 4]) else None,
        'gen_sales_goods_ytd': float(df.iloc[10, 5]) if pd.notna(df.iloc[10, 5]) else None,
        # ... 继续提取其他字段
        
        # 即征即退项目数据
        'ref_sales_taxable_current': float(df.iloc[9, 6]) if pd.notna(df.iloc[9, 6]) else None,
        'ref_sales_taxable_ytd': float(df.iloc[9, 7]) if pd.notna(df.iloc[9, 7]) else None,
        # ... 继续提取
        
        # 申报信息
        'preparer': str(df.iloc[-4, 1]) if pd.notna(df.iloc[-4, 1]) else None,
        'preparer_id_card': str(df.iloc[-3, 1]) if pd.notna(df.iloc[-3, 1]) else None,
    }
    
    # 构建INSERT语句
    columns = ', '.join(data_dict.keys())
    placeholders = ', '.join(['?' for _ in data_dict])
    
    cursor.execute(f'''
        INSERT OR REPLACE INTO fact_vat_return ({columns})
        VALUES ({placeholders})
    ''', tuple(data_dict.values()))
    
    conn.commit()
    conn.close()
    
    print(f"成功导入 {company_name} {tax_period} 期间的申报数据")

# 使用示例
if __name__ == '__main__':
    import_vat_return('增值税申报表主表（raw）.xlsx')
```

### 6. 性能优化配置

```sql
-- 数据库优化设置
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = -64000;  -- 64MB缓存
PRAGMA temp_store = MEMORY;
PRAGMA page_size = 4096;

-- 分析表以优化查询计划
ANALYZE;
```

### 7. 常用查询视图

```sql
-- 创建汇总查询视图
CREATE VIEW v_vat_summary AS
SELECT 
    c.taxpayer_id,
    c.company_name,
    c.industry,
    p.tax_period,
    p.year,
    p.month,
    p.quarter,
    f.gen_sales_taxable_current,
    f.gen_tax_payable_current,
    f.gen_tax_total_current,
    f.urban_construction_tax_current,
    f.education_surcharge_current,
    f.local_education_surcharge_current,
    f.filing_date
FROM fact_vat_return f
JOIN dim_company c ON f.company_id = c.company_id
JOIN dim_period p ON f.period_id = p.period_id;

-- 创建年度汇总视图
CREATE VIEW v_vat_annual_summary AS
SELECT 
    c.taxpayer_id,
    c.company_name,
    c.industry,
    p.year,
    SUM(f.gen_sales_taxable_current) as total_sales,
    SUM(f.gen_tax_total_current) as total_tax,
    SUM(f.urban_construction_tax_current) as total_urban_tax,
    SUM(f.education_surcharge_current) as total_education_surcharge,
    COUNT(*) as return_count
FROM fact_vat_return f
JOIN dim_company c ON f.company_id = c.company_id
JOIN dim_period p ON f.period_id = p.period_id
GROUP BY c.taxpayer_id, c.company_name, c.industry, p.year;
```

